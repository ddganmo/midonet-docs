<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:exsl="http://exslt.org/common" xmlns:ng="http://docbook.org/docbook-ng" xmlns:fb="http://ogp.me/ns/fb#"><head>
<link href="https://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet"/>
<title>Chapter 6. MidoNet Cluster - MidoNet Reference Architecture
   - 5.1-rev1</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"/><meta name="mavenGroupId" content="org.midonet"/><meta name="mavenArtifactId" content="midonet-docs-reference-architecture-en"/><meta name="mavenVersionId" content="5.1-rev1"/><link rel="home" href="index.html" title="MidoNet Reference Architecture"/><link rel="up" href="index.html" title="MidoNet Reference Architecture"/><link rel="prev" href="midolman.html" title="Chapter 5. Midolman"/><link rel="next" href="midonet_cli.html" title="Chapter 7. MidoNet Command Line Interface"/><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta name="git-sha" content="49ab81e3d5352b30c944f4e0d1645bbcb04a5cc3"/><meta name="buildTime" content="2016-04-19T07:42:21+00:00"/><script type="text/javascript">
            //The id for tree cookie
            var treeCookieId = "treeview-book_reference_architecture_en";
            var language = "en";
            var w = new Object();
            //Localization
            txt_filesfound = 'Results';
            txt_enter_at_least_1_char = "You must enter at least one character.";
            txt_browser_not_supported = "Please enable JavaScript.";
            txt_please_wait = "Please wait. Search in progress...";
            txt_results_for = "Results for: ";
        </script><style type="text/css">
            input {
            margin-bottom: 5px;
            margin-top: 2px;
            }

            .folder {
            display: block;
            height: 22px;
            padding-left: 20px;
            background: transparent url(../common/jquery/treeview/images/folder.gif) 0 0px no-repeat;
            }
            
        </style><link rel="shortcut icon" href="../favicon.ico" type="image/x-icon"/><link rel="stylesheet" type="text/css" href="../common/css/positioning.css"/><link rel="stylesheet" type="text/css" href="../common/css/custom.css"/><!--[if IE]>
	<link rel="stylesheet" type="text/css" href="../common/css/ie.css"/>
	<![endif]--><link rel="stylesheet" type="text/css" href="../common/jquery/theme-redmond/jquery-ui-1.8.2.custom.css"/><link rel="stylesheet" type="text/css" href="../common/jquery/treeview/jquery.treeview.css"/><script type="text/javascript" src="https://code.jquery.com/jquery-1.11.0.min.js"><!----></script><script type="text/javascript" src="../common/jquery/jquery-ui-1.8.2.custom.min.js"><!----></script><script type="text/javascript" src="../common/jquery/jquery.cookie.js"><!----></script><script type="text/javascript" src="../common/jquery/treeview/jquery.treeview.min.js"><!----></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/qtip2/2.2.0/jquery.qtip.min.css"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/qtip2/2.2.0/jquery.qtip.min.js"><!--jQuery plugin for glossary popups. --></script><script type="text/javascript" src="search/htmlFileList.js"><!----></script><script type="text/javascript" src="search/htmlFileInfoList.js"><!----></script><script type="text/javascript" src="search/nwSearchFnt.js"><!----></script><script type="text/javascript" src="search/stemmers/en_stemmer.js"><!--//make this scalable to other languages as well.--></script><script type="text/javascript" src="search/index-1.js"><!----></script><script type="text/javascript" src="search/index-2.js"><!----></script><script type="text/javascript" src="search/index-3.js"><!----></script><script type="text/javascript">
	    var _gaq = _gaq || [];
	    _gaq.push(['_setAccount', 'UA-56283377-4']);
	    
	    _gaq.push(['_setDomainName', '.midonet.org']);	        
	        </script><script type="text/javascript" src="../common/ga.js"><!----></script></head><body><div id="header"><a onclick="_gaq.push(['_trackEvent', 'Header', 'logo', 'click', 1]);" target="_blank" href="https://www.midonet.org"><img src="../common/images/midonet-logo.png" alt="MidoNet Documentation" width="157" height="47"/></a><h1>Chapter 6. MidoNet Cluster</h1><div id="navheader" align="right"><!----><table class="navLinks"><tr><td><a id="showHideButton" onclick="showHideToc(); _gaq.push(['_trackEvent', 'Header', 'show/hide', 'click', 1]);" class="pointLeft" title="Hide TOC tree">Sidebar
                            </a></td><td><a accesskey="p" class="navLinkPrevious" onclick="_gaq.push(['_trackEvent', 'Header', 'prevLink', 'click', 1]);" tabindex="5" href="midolman.html">Prev</a> 
				  |
                                    <a accesskey="n" class="navLinkNext" onclick="_gaq.push(['_trackEvent', 'Header', 'nextLink', 'click', 1]);" tabindex="5" href="midonet_cli.html">Next</a></td></tr></table></div></div><div id="toolbar" class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"><div id="toolbar-left"><p class="breadcrumbs"><a href="https://docs.midonet.org/">MidoNet Manuals</a><a href="index.html">MidoNet Reference Architecture
   - 5.1-rev1</a></p><a onclick="_gaq.push(['_trackEvent', 'Header', 'pdfDownload', 'click', 1]);" alt="Download a pdf of this document" class="pdficon" href="../MidoNet_Reference_Architecture_EN_5.1-rev1.pdf"><img src="../common/images/pdf.png"/></a><div id="gplusone"><a id="AskOOLink1" href="https://github.com/midonet/midonet/wiki/Communication" target="_blank" title="Questions? Discuss on Mailing Lists or Chat."><i class="icon-question"><!----></i></a>  
        <a id="logABugLink1" href="https://midonet.atlassian.net/browse/MND/" target="_blank" title="Found an error? Report a bug."><i class="icon-bug"><!----></i></a></div></div></div><div id="content"><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="midonet_cluster"> </a>Chapter 6. MidoNet Cluster</h2></div></div></div><div class="toc"><p><strong>Contents</strong></p><dl><dt><span class="section"><a href="midonet_cluster.html#_recommended_installation_nodes_2">Recommended installation nodes</a></span></dt><dt><span class="section"><a href="midonet_cluster.html#_fault_tolerant_configuration_guidelines_3">Fault-tolerant configuration guidelines</a></span></dt><dt><span class="section"><a href="midonet_cluster.html#_midonet_rest_api_http_endpoint">MidoNet REST API HTTP endpoint</a></span></dt><dt><span class="section"><a href="midonet_cluster.html#_midonet_rest_api_https_endpoint">MidoNet REST API HTTPS endpoint</a></span></dt></dl></div><p>The MidoNet Cluster is a new type of node introduced in MidoNet v5 that
replaces the MidoNet API.  The MidoNet Cluster provides the REST API
endpoint, and also hosts a number of management services such as VxLAN
Gateway Controller.</p><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="_recommended_installation_nodes_2"> </a>Recommended installation nodes</h2></div></div></div><p>The MidoNet Cluster can be installed on any node with access to the
ZooKeeper cluster (which typically uses three ports: TCP/2181, TCP/2888,
and TCP/3888.</p><p>For test/evaluation purposes MidoNet Cluster, ZooKeeper and Cassandra
can coexist on the same physical host.</p><p>Note however that such configuration is discouraged for production
deployments.  In this case, each of MidoNet Cluster, ZooKeeper and
Casandra should be placed in dedicated nodes.</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="_fault_tolerant_configuration_guidelines_3"> </a>Fault-tolerant configuration guidelines</h2></div></div></div><p>In order to provide a fault-tolerant solution, we recommend running
several instances of the MidoNet Cluster on different nodes and then
exposing a common virtual IP (VIP) address using an external load
balancer to distribute the API calls between the instances.</p><p>No special load balancer features are needed, so any load balancer will
work.</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="_midonet_rest_api_http_endpoint"> </a>MidoNet REST API HTTP endpoint</h2></div></div></div><p>The MidoNet Cluster exposes a RESTful API running over the Hypertext
Transfer Protocol (HTTP) that provides the integration point between
external applications (including the cloud controller) and the internal
MidoNet configurations.  The REST API is stateless, so you can scale out
this service by simply adding more Cluster nodes.</p><p>The MidoNet REST API supports OpenStack Keystone authentication.</p><p>The REST API will be exposed on port TCP/8181 by default.
This port can be changed with the following mn-conf command:</p><pre class="screen">echo "cluster.rest_api.http_port = $NEW_PORT" | mn-conf set -t default</pre></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="_midonet_rest_api_https_endpoint"> </a>MidoNet REST API HTTPS endpoint</h2></div></div></div><p>HTTPS is also available and exposed on port TCP/8443 by default. This
port can be changed with the following mn-conf command:</p><pre class="screen">echo "cluster.rest_api.https_port = $NEW_PORT" | mn-conf set -t default</pre><p>MidoNet Cluster will disable the HTTPS endpoint if the port is set to a
value equal or less than 0, or if no keystore is accessible on the system.</p><p>The MidoNet Cluster will expect to find a keystore containing the
certificate in <code class="literal">/etc/midonet-cluster/ssl/midonet.jks</code>.</p><p>This location can be overridden by setting the midonet.keystore_path
system variable to a different path.</p><p>To generate a self-signed key, you can use the following procedure. Note that
you will be prompted for passwords during this process, and need to keep the
keystore password for later use.</p><pre class="screen">openssl genrsa -des3 -out midonet.key 2048
openssl rsa -in midonet.key -out midonet.key
openssl req -sha256 -new -key midonet.key -out midonet.csr -subj '/CN=localhost'
openssl x509 -req -days 365 -in midonet.csr -signkey midonet.key -out midonet.crt</pre><p>Now we will combine the private key into the cert, because we generated them
separately:</p><pre class="screen">openssl pkcs12 -inkey midonet.key -in midonet.crt -export -out midonet.pkcs12</pre><p>And load the certificate into the keystore:</p><pre class="screen">keytool -importkeystore -srckeystore midonet.pkcs12 -srcstoretype PKCS12 -destkeystore midonet.jks</pre><p>Now place the keystore in the default location:</p><pre class="screen">mv midonet.jks /etc/midonet-cluster/ssl</pre><p>For more advanced key management, including adding your own certificate
to the keystore, please refer to the following documentation:</p><p><a class="link" href="https://www.eclipse.org/jetty/documentation/current/configuring-ssl.html" target="_top">https://www.eclipse.org/jetty/documentation/current/configuring-ssl.html</a></p></div></div><script type="text/javascript" src="../common/main.js"><!----></script><div class="logabug" style="text-align: center"><a id="AskOOLink2" href="https://github.com/midonet/midonet/wiki/Communication" target="_blank"><i class="icon-question"><!----></i>Questions? Discuss on Mailing Lists or Chat.</a><br/><a id="logABugLink2" href="https://midonet.atlassian.net/browse/MND/" target="_blank"><i class="icon-bug"><!----></i>Found an error? Report a bug.</a></div><hr/><div id="disqus_thread"><script type="text/javascript">
	      if(window.location.protocol.substring(0,4) == 'http'){
	        var disqus_shortname = 'midonet';
	      
	        var disqus_identifier = 'book_reference_architecture_en5.1-rev1midonet_cluster';
	      
	      }
	    </script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><script type="text/javascript" src="../common/comments.js"><!----></script></div><hr/><div class="legal"><a href="index.html">Legal notices</a></div></div><div><div id="leftnavigation" style="padding-top:3px; background-color:white;"><div id="tabs"><ul><li><a href="#treeDiv" tabindex="1"><span class="contentsTab">Contents</span></a></li><li><a href="#searchDiv" tabindex="1"><span class="searchTab">Search</span></a></li></ul><div id="treeDiv"><img src="../common/images/loading.gif" alt="loading table of contents..." id="tocLoading" style="display:block;"/><div id="ulTreeDiv" style="display:none" class="thisisthat"><ul id="tree" class="filetree"><li tabindex="2"><span class="file"><a href="preface.html">Preface</a></span><ul><li tabindex="2"><span class="file"><a href="preface.html#_conventions">Conventions</a></span><ul><li tabindex="2"><span class="file"><a href="preface.html#_notices">Notices</a></span></li><li tabindex="2"><span class="file"><a href="preface.html#_command_prompts">Command prompts</a></span></li></ul></li></ul></li><li tabindex="2"><span class="file"><a href="midoNet_overview.html">1. MidoNet overview</a></span><ul><li tabindex="2"><span class="file"><a href="midonet_key_features.html">MidoNet key features</a></span></li><li tabindex="2"><span class="file"><a href="recommended_hardware.html">Recommended Hardware</a></span></li><li tabindex="2"><span class="file"><a href="installation_requirements.html">Requirements for installation</a></span><ul><li tabindex="2"><span class="file"><a href="installation_requirements.html#_operating_system">Operating System</a></span></li><li tabindex="2"><span class="file"><a href="installation_requirements.html#_bgp_setup_requirements">BGP Setup Requirements</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="openstack_integration.html">OpenStack integration</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="midonet_network_architecture.html">2. MidoNet network architecture</a></span><ul><li tabindex="2"><span class="file"><a href="internal_network.html">Internal and underlay network</a></span></li><li tabindex="2"><span class="file"><a href="underlay_network.html">Underlay network</a></span><ul><li tabindex="2"><span class="file"><a href="underlay_network.html#_gre_and_vxlan_tunnels">GRE and VXLAN tunnels</a></span></li><li tabindex="2"><span class="file"><a href="underlay_network.html#_mtu_size_considerations_for_the_underlay_network">MTU size considerations for the underlay network</a></span></li><li tabindex="2"><span class="file"><a href="underlay_network.html#_mtu_size_considerations_for_the_overlay_network">MTU size considerations for the overlay network</a></span></li><li tabindex="2"><span class="file"><a href="underlay_network.html#_offloading_on_l3_gateway_uplink_nic">Offloading on L3 Gateway uplink NIC</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="bgp_setup_and_layer_3_topologies.html">BGP setup and Layer-3 topologies</a></span></li><li tabindex="2"><span class="file"><a href="virtual_routers.html">Virtual routers</a></span></li><li tabindex="2"><span class="file"><a href="compute_host_agents.html">Compute Host Agents</a></span></li><li tabindex="2"><span class="file"><a href="bridges.html">Bridges</a></span></li><li tabindex="2"><span class="file"><a href="metadata_server.html">Metadata server</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="solution_components.html">3. Solution components</a></span><ul><li tabindex="2"><span class="file"><a href="state_management.html">State Management</a></span><ul><li tabindex="2"><span class="file"><a href="zookeeper.html">ZooKeeper</a></span><ul><li tabindex="2"><span class="file"><a href="zookeeper.html#_necessary_software">Necessary software</a></span></li><li tabindex="2"><span class="file"><a href="zookeeper.html#_fault_tolerant_configuration_guidelines">Fault-tolerant configuration guidelines</a></span></li><li tabindex="2"><span class="file"><a href="zookeeper.html#_accessibility_considerations">Accessibility considerations</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="cassandra.html">Cassandra</a></span><ul><li tabindex="2"><span class="file"><a href="cassandra.html#_necessary_software_2">Necessary software</a></span></li><li tabindex="2"><span class="file"><a href="cassandra.html#_fault_tolerant_configuration_guidelines_2">Fault-tolerant configuration guidelines</a></span></li><li tabindex="2"><span class="file"><a href="cassandra.html#_accessibility_considerations_2">Accessibility considerations</a></span></li></ul></li></ul></li></ul></li><li tabindex="2"><span class="file"><a href="gateway_nodes.html">4. MidoNet gateway nodes</a></span><ul><li tabindex="2"><span class="file"><a href="gateway_nodes.html#_gateway_node_requirements">Gateway node requirements</a></span></li><li tabindex="2"><span class="file"><a href="gateway_nodes.html#_gateway_node_connectivity">Gateway node connectivity</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="midolman.html">5. Midolman</a></span><ul><li tabindex="2"><span class="file"><a href="midolman.html#_recommended_installation_nodes">Recommended installation nodes</a></span></li><li tabindex="2"><span class="file"><a href="midolman.html#_configuration_guidelines">Configuration guidelines</a></span></li><li tabindex="2"><span class="file"><a href="midolman.html#_network_accessibility_considerations">Network accessibility considerations</a></span></li></ul></li><li tabindex="2" id="webhelp-currentid"><span class="file"><a href="midonet_cluster.html">6. MidoNet Cluster</a></span><ul><li tabindex="2"><span class="file"><a href="midonet_cluster.html#_recommended_installation_nodes_2">Recommended installation nodes</a></span></li><li tabindex="2"><span class="file"><a href="midonet_cluster.html#_fault_tolerant_configuration_guidelines_3">Fault-tolerant configuration guidelines</a></span></li><li tabindex="2"><span class="file"><a href="midonet_cluster.html#_midonet_rest_api_http_endpoint">MidoNet REST API HTTP endpoint</a></span></li><li tabindex="2"><span class="file"><a href="midonet_cluster.html#_midonet_rest_api_https_endpoint">MidoNet REST API HTTPS endpoint</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="midonet_cli.html">7. MidoNet Command Line Interface</a></span></li></ul></div></div><div id="searchDiv"><div id="search"><form onsubmit="Verifie(ditaSearch_Form);return false" name="ditaSearch_Form" class="searchForm"><fieldset class="searchFieldSet"><legend>Search</legend><center><input id="textToSearch" name="textToSearch" type="text" class="searchText"/> &nbsp; <input onclick="Verifie(ditaSearch_Form)" type="button" class="searchButton" value="Go" id="doSearch"/></center></fieldset></form></div><div id="searchResults"><center/></div><p class="searchHighlight"><a href="#" onclick="toggleHighlight()">Search Highlighter (On/Off)</a></p></div></div></div></div></body></html>